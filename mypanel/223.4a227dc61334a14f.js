"use strict";(self.webpackChunkopenmediavault_workbench=self.webpackChunkopenmediavault_workbench||[]).push([[223],{4223:(j,f,s)=>{s.r(f),s.d(f,{UsermgmtModule:()=>Z});var F=s(6895),x=s(9394),c=s(5166),e=s(8584),C=s(9076),U=s(3642),a=s(4650),d=s(7839);let S=(()=>{class t{constructor(){this.config={stateId:"6846696d-6834-45b8-9154-423488469072",autoReload:!1,remoteSorting:!0,remotePaging:!0,remoteSearching:!0,hasSearchField:!0,rowId:"name",rowEnumFmt:"{{ name }}",columns:[{name:(0,e.J)("Name"),prop:"name",flexGrow:1,sortable:!0},{name:(0,e.J)("GID"),prop:"gid",flexGrow:1,sortable:!0,hidden:!0},{name:(0,e.J)("Members"),prop:"members",flexGrow:1,sortable:!0,cellTemplateName:"template",cellTemplateConfig:'{{ members | sort() | join(", ") }}'},{name:(0,e.J)("Tags"),prop:"comment",cellTemplateName:"chip",cellTemplateConfig:{separator:","},flexGrow:1,sortable:!0}],sorters:[{dir:"asc",prop:"name"}],store:{proxy:{service:"UserMgmt",get:{method:"getGroupList"}}},actions:[{type:"menu",icon:"add",tooltip:(0,e.J)("Create | Import"),actions:[{template:"create",execute:{type:"url",url:"/usermgmt/groups/create"}},{type:"iconButton",text:(0,e.J)("Import"),icon:"import",execute:{type:"url",url:"/usermgmt/groups/import"}}]},{template:"edit",execute:{type:"url",url:"/usermgmt/groups/edit/{{ _selected[0].name }}"}},{type:"iconButton",icon:"mdi:folder-key",tooltip:(0,e.J)("Shared folder permissions"),enabledConstraints:{minSelected:1,maxSelected:1},execute:{type:"url",url:"/usermgmt/groups/permissions/{{ _selected[0].name }}"}},{template:"delete",enabledConstraints:{minSelected:1,constraint:[{operator:"z",arg0:{prop:"members"}}]},execute:{type:"request",request:{service:"UserMgmt",method:"deleteGroup",params:{name:"{{ name }}"}}}}]}}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-datatable-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[d.N],encapsulation:2}),t})();var p=s(7713),u=s(6316);let h=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",get:{method:"getGroup",params:{name:"{{ _routeParams.name }}"}},post:{method:"setGroup"}},fields:[{type:"textInput",name:"name",label:(0,e.J)("Name"),disabled:"{{ _routeConfig.data.editing | toboolean }}",value:"{{ _routeParams.name }}",validators:{required:!0,patternType:"groupName"}},{type:"select",name:"members",label:(0,e.J)("Members"),placeholder:(0,e.J)("Select members ..."),multiple:!0,valueField:"name",textField:"name",value:[],store:{proxy:{service:"UserMgmt",get:{method:"enumerateAllUsers"}},sorters:[{dir:"asc",prop:"name"}]}},{type:"tagInput",name:"comment",label:(0,e.J)("Tags"),value:"",validators:{maxLength:65}}],buttons:[{template:"submit",execute:{type:"url",url:"/usermgmt/groups"}},{template:"cancel",execute:{type:"url",url:"/usermgmt/groups"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})(),w=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",post:{method:"importGroups",task:!0}},fields:[{type:"textarea",name:"csv",value:"# <groupname>;<gid>;<tags>",hint:(0,e.J)("Each line represents a group."),monospace:!0,rows:10}],buttons:[{template:"submit",text:(0,e.J)("Import"),execute:{type:"url",url:"/usermgmt/groups"}},{template:"cancel",execute:{type:"url",url:"/usermgmt/groups"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})();var i=s(7489),y=s(7169),v=s(8001),b=s(7161),P=s(2598);const T=["page"];let G=(()=>{class t{constructor(o,n,l){this.router=o,this.rpcService=n,this.notificationService=l,this.config={stateId:"21212794-27c1-11ea-abdb-e3fc0648b2ae",autoReload:!1,limit:0,hasFooter:!1,hasSearchField:!0,hints:[{type:"info",text:(0,e.J)('These settings are used by the services to configure the access rights for the group "{{ _routeParams.name }}". Please note that these settings have no effect on file system permissions.')}],selectionType:"none",columns:[{name:(0,e.J)("Shared folder"),prop:"name",flexGrow:1,sortable:!0},{name:(0,e.J)("Permissions"),prop:"perms",flexGrow:1,sortable:!0,cellTemplateName:"buttonToggle",cellTemplateConfig:{buttons:[{value:"7",text:(0,e.J)("Read/Write")},{value:"5",text:(0,e.J)("Read-only")},{value:"0",text:(0,e.J)("No access")}]}}],sorters:[{dir:"asc",prop:"name"}],store:{proxy:{service:"ShareMgmt",get:{method:"getPrivilegesByRole",params:{role:"group",name:"{{ _routeParams.name }}"}}}},buttons:[{template:"cancel",url:"/usermgmt/groups"},{text:(0,e.J)("Save"),class:"omv-background-color-pair-primary",click:this.onSave.bind(this)}]}}onSave(){const o=i.map(i.reject(this.page.table.data,["perms",null]),n=>({uuid:n.uuid,perms:i.toInteger(n.perms)}));this.rpcService.request("ShareMgmt","setPrivilegesByRole",{role:"group",name:i.get(this.page.routeParams,"name"),privileges:o}).subscribe(()=>{this.notificationService.show(v.k.success,(0,y.WU)(i.get(this.page.routeConfig,"data.notificationTitle"),this.page.routeParams)),this.router.navigate(["/usermgmt/groups"])})}}return t.\u0275fac=function(o){return new(o||t)(a.Y36(c.F0),a.Y36(P.G),a.Y36(b.g))},t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(o,n){if(1&o&&a.Gf(T,7),2&o){let l;a.iGM(l=a.CRH())&&(n.page=l.first)}},decls:2,vars:1,consts:[[3,"config"],["page",""]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-datatable-page",0,1),2&o&&a.Q6J("config",n.config)},dependencies:[d.N],encapsulation:2}),t})(),I=(()=>{class t{constructor(){this.config={stateId:"9dd2c07e-4572-4112-9de7-c3ccad5ef52e",autoReload:!1,remoteSorting:!0,remotePaging:!0,remoteSearching:!0,hasSearchField:!0,rowId:"name",rowEnumFmt:"{{ name }}",columns:[{name:(0,e.J)("Name"),prop:"name",flexGrow:1,sortable:!0},{name:(0,e.J)("UID"),prop:"uid",flexGrow:1,sortable:!0,hidden:!0},{name:(0,e.J)("GID"),prop:"gid",flexGrow:1,sortable:!0,hidden:!0},{name:(0,e.J)("Email"),prop:"email",flexGrow:1,sortable:!0},{name:(0,e.J)("Groups"),prop:"groups",flexGrow:1,sortable:!0,cellTemplateName:"template",cellTemplateConfig:'{{ groups | sort() | join(", ") }}'},{name:(0,e.J)("Tags"),prop:"comment",cellTemplateName:"chip",cellTemplateConfig:{separator:","},flexGrow:1,sortable:!0}],sorters:[{dir:"asc",prop:"name"}],store:{proxy:{service:"UserMgmt",get:{method:"getUserList"}}},actions:[{type:"menu",icon:"add",tooltip:(0,e.J)("Create | Import"),actions:[{template:"create",execute:{type:"url",url:"/usermgmt/users/create"}},{type:"iconButton",text:(0,e.J)("Import"),icon:"import",execute:{type:"url",url:"/usermgmt/users/import"}}]},{template:"edit",execute:{type:"url",url:"/usermgmt/users/edit/{{ _selected[0].name }}"}},{type:"iconButton",icon:"mdi:folder-key",tooltip:(0,e.J)("Shared folder permissions"),enabledConstraints:{minSelected:1,maxSelected:1},execute:{type:"url",url:"/usermgmt/users/permissions/{{ _selected[0].name }}"}},{template:"delete",execute:{type:"request",request:{service:"UserMgmt",method:"deleteUser",params:{name:"{{ name }}"}}}}]}}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-datatable-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[d.N],encapsulation:2}),t})(),J=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",get:{method:"getUser",params:{name:"{{ _routeParams.name }}"}},post:{method:"setUser"}},fields:[{type:"textInput",name:"name",label:(0,e.J)("Name"),disabled:"{{ _routeConfig.data.editing | toboolean }}",value:"{{ _routeParams.name }}",autocomplete:"off",validators:{required:!0,patternType:"userName"}},{type:"textInput",name:"email",label:(0,e.J)("Email"),value:"",autocomplete:"off",validators:{patternType:"email"}},{type:"passwordInput",name:"password",label:(0,e.J)("Password"),value:"",autocomplete:"new-password",validators:{required:"{{ _routeConfig.data.editing | toboolean === false }}"}},{type:"passwordInput",name:"passwordconf",label:(0,e.J)("Confirm password"),submitValue:!1,value:"",autocomplete:"new-password",validators:{custom:[{constraint:{operator:"eq",arg0:{prop:"password"},arg1:{prop:"passwordconf"}},errorData:(0,e.J)("Password does not match.")}]}},{type:"select",name:"shell",label:(0,e.J)("Shell"),placeholder:(0,e.J)("Select a shell ..."),value:"/bin/sh",store:{proxy:{service:"System",get:{method:"getShells"}},sorters:[{dir:"asc",prop:"text"}]}},{type:"select",name:"groups",label:(0,e.J)("Groups"),placeholder:(0,e.J)("Select groups ..."),multiple:!0,valueField:"name",textField:"name",value:[],store:{proxy:{service:"UserMgmt",get:{method:"enumerateAllGroups"}},sorters:[{dir:"asc",prop:"name"}]}},{type:"datatable",name:"sshpubkeys",label:(0,e.J)("SSH public keys"),hasHeader:!1,hasFooter:!1,columns:[{prop:"sshpubkey",flexGrow:1,cellClass:"omv-text-wrap omv-text-monospace"}],actions:[{template:"add",formDialogConfig:{title:(0,e.J)("SSH public key"),fields:[{type:"fileInput",name:"sshpubkey",value:"",rows:10,wrap:"off",monospace:!0,trim:!0,label:(0,e.J)("Public key"),hint:(0,e.J)("The SSH public key in OpenSSH or RFC 4716 format."),validators:{required:!0,patternType:"sshPubKey"}}]}},{template:"delete"}],valueType:"string",value:[]},{type:"checkbox",name:"disallowusermod",label:(0,e.J)("Disallow account modification"),value:!1,hint:(0,e.J)("Disallow the user to modify their own account.")},{type:"tagInput",name:"comment",label:(0,e.J)("Tags"),value:"",validators:{maxLength:65}}],buttons:[{template:"submit",execute:{type:"url",url:"/usermgmt/users"}},{template:"cancel",execute:{type:"url",url:"/usermgmt/users"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})(),D=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",post:{method:"importUsers",task:!0}},fields:[{type:"textarea",name:"csv",value:"# <username>;<uid>;<tags>;<email>;<password>;<shell>;<groupname,groupname,...>;<disallowusermod>",hint:(0,e.J)("Each line represents a user. Note, the password must be entered in plain text."),monospace:!0,rows:10}],buttons:[{template:"submit",text:(0,e.J)("Import"),execute:{type:"url",url:"/usermgmt/users"}},{template:"cancel",execute:{type:"url",url:"/usermgmt/users"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})(),M=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",post:{method:"setPasswordByContext"}},fields:[{type:"passwordInput",name:"password",label:(0,e.J)("New password"),autocomplete:"new-password",validators:{required:!0}},{type:"passwordInput",name:"passwordconf",label:(0,e.J)("Confirm password"),submitValue:!1,validators:{required:!0,custom:[{constraint:{operator:"eq",arg0:{prop:"password"},arg1:{prop:"passwordconf"}},errorData:(0,e.J)("Password doesn't match.")}]}}],buttons:[{template:"submit",execute:{type:"url",url:"/"}},{template:"cancel",execute:{type:"url",url:"/"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})(),B=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",get:{method:"getUserByContext"},post:{method:"setUserByContext"}},fields:[{type:"hidden",name:"_readonly",value:!1},{type:"textInput",name:"name",label:(0,e.J)("Name"),readonly:!0},{type:"textInput",name:"email",label:(0,e.J)("Email"),value:"",validators:{patternType:"email"}},{type:"tagInput",name:"comment",label:(0,e.J)("Tags"),value:"",validators:{maxLength:65}}],buttons:[{template:"submit",enabledConstraint:{operator:"falsy",arg0:{prop:"_readonly"}}},{template:"cancel",execute:{type:"url",url:"/"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})(),N=(()=>{class t extends p.Fy{constructor(){super(...arguments),this.config={request:{service:"UserMgmt",get:{method:"getSettings"},post:{method:"setSettings"}},fields:[{type:"paragraph",title:(0,e.J)("User home directory")},{type:"checkbox",name:"enable",label:(0,e.J)("Enabled"),value:!1},{type:"sharedFolderSelect",name:"sharedfolderref",label:(0,e.J)("Location"),hint:(0,e.J)("The location of the user home directories."),hasEmptyOption:!0,value:"",validators:{requiredIf:{operator:"eq",arg0:{prop:"enable"},arg1:!0}}}],buttons:[{template:"submit"},{template:"cancel",execute:{type:"url",url:"/usermgmt"}}]}}}return t.\u0275fac=function(){let r;return function(n){return(r||(r=a.n5z(t)))(n||t)}}(),t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],features:[a.qOj],decls:1,vars:1,consts:[[3,"config"]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-form-page",0),2&o&&a.Q6J("config",n.config)},dependencies:[u.g],encapsulation:2}),t})();const R=["page"];let Q=(()=>{class t{constructor(o,n,l){this.router=o,this.rpcService=n,this.notificationService=l,this.config={stateId:"3752268a-27c1-11ea-a5b1-a3d1c7dcb22c",autoReload:!1,limit:0,hasFooter:!1,hasSearchField:!0,hints:[{type:"info",text:(0,e.J)('These settings are used by the services to configure the access rights for the user "{{ _routeParams.name }}". Please note that these settings have no effect on file system permissions.')}],selectionType:"none",columns:[{name:(0,e.J)("Shared folder"),prop:"name",flexGrow:1,sortable:!0},{name:(0,e.J)("Permissions"),prop:"perms",flexGrow:1,sortable:!0,cellTemplateName:"buttonToggle",cellTemplateConfig:{buttons:[{value:"7",text:(0,e.J)("Read/Write")},{value:"5",text:(0,e.J)("Read-only")},{value:"0",text:(0,e.J)("No access")}]}}],sorters:[{dir:"asc",prop:"name"}],store:{proxy:{service:"ShareMgmt",get:{method:"getPrivilegesByRole",params:{role:"user",name:"{{ _routeParams.name }}"}}}},buttons:[{template:"submit",click:this.onSave.bind(this)},{template:"cancel",url:"/usermgmt/users"}]}}onSave(){const o=i.map(i.reject(this.page.table.data,["perms",null]),n=>({uuid:n.uuid,perms:i.toInteger(n.perms)}));this.rpcService.request("ShareMgmt","setPrivilegesByRole",{role:"user",name:i.get(this.page.routeParams,"name"),privileges:o}).subscribe(()=>{this.notificationService.show(v.k.success,(0,y.WU)(i.get(this.page.routeConfig,"data.notificationTitle"),this.page.routeParams)),this.router.navigate(["/usermgmt/users"])})}}return t.\u0275fac=function(o){return new(o||t)(a.Y36(c.F0),a.Y36(P.G),a.Y36(b.g))},t.\u0275cmp=a.Xpm({type:t,selectors:[["ng-component"]],viewQuery:function(o,n){if(1&o&&a.Gf(R,7),2&o){let l;a.iGM(l=a.CRH())&&(n.page=l.first)}},decls:2,vars:1,consts:[[3,"config"],["page",""]],template:function(o,n){1&o&&a._UZ(0,"omv-intuition-datatable-page",0,1),2&o&&a.Q6J("config",n.config)},dependencies:[d.N],encapsulation:2}),t})();var m=s(1885);const g=[{path:"",component:C.Z},{path:"change-password",component:M,canDeactivate:[m.e],data:{title:(0,e.J)("Change Password"),editing:!0,notificationTitle:(0,e.J)("Updated password.")}},{path:"profile",component:B,canDeactivate:[m.e],data:{title:(0,e.J)("Profile"),editing:!0,notificationTitle:(0,e.J)("Updated user profile.")}},{path:"users",data:{title:(0,e.J)("Users")},children:[{path:"",component:I},{path:"create",component:J,canDeactivate:[m.e],data:{title:(0,e.J)("Create"),editing:!1,notificationTitle:(0,e.J)('Created user "{{ name }}".')}},{path:"import",component:D,canDeactivate:[m.e],data:{title:(0,e.J)("Import"),notificationTitle:(0,e.J)("Imported users.")}},{path:"edit/:name",component:J,canDeactivate:[m.e],data:{title:(0,e.J)("Edit"),editing:!0,notificationTitle:(0,e.J)('Updated user "{{ name }}".')}},{path:"permissions/:name",component:Q,data:{title:(0,e.J)("Permissions"),breadcrumb:{text:'{{ "Permissions" | translate }} @ {{ _routeParams.name }}'},notificationTitle:(0,e.J)('Updated permissions of user "{{ name }}".')}}]},{path:"groups",data:{title:(0,e.J)("Groups")},children:[{path:"",component:S},{path:"create",component:h,canDeactivate:[m.e],data:{title:(0,e.J)("Create"),editing:!1,notificationTitle:(0,e.J)('Created group "{{ name }}".')}},{path:"import",component:w,canDeactivate:[m.e],data:{title:(0,e.J)("Import"),notificationTitle:(0,e.J)("Imported groups.")}},{path:"edit/:name",component:h,canDeactivate:[m.e],data:{title:(0,e.J)("Edit"),editing:!0,notificationTitle:(0,e.J)('Updated group "{{ name }}".')}},{path:"permissions/:name",component:G,data:{title:(0,e.J)("Permissions"),breadcrumb:{text:'{{ "Permissions" | translate }} @ {{ _routeParams.name }}'},notificationTitle:(0,e.J)('Updated permissions of group "{{ name }}".')}}]},{path:"settings",component:N,canDeactivate:[m.e],data:{title:(0,e.J)("Settings"),editing:!0,notificationTitle:(0,e.J)("Updated settings.")}}];let q=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({providers:[{provide:c.Z6,multi:!0,useFactory:r=>(r.inject("usermgmt",g),g),deps:[U.o]}],imports:[c.Bz.forChild(g),c.Bz]}),t})(),Z=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[F.ez,x.I,q]}),t})()}}]);